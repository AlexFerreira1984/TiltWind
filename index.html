<!DOCTYPE html>
<html>
<head>
  <title>TiltWind BLE Monitor</title>
</head>
<body>
  <h1>TiltWind BLE Monitor</h1>
  <button id="connectButton">Connect to TiltWind</button>
  <div id="data"></div>

  <script>
    const serviceUUID = "0000180F-0000-1000-8000-00805F9B34FB"; // Battery Service UUID
    const characteristicUUIDs = {
      windDirection: "00002A6D-0000-1000-8000-00805F9B34FB",
      windSpeed: "00002A70-0000-1000-8000-00805F9B34FB",
      gustSpeed: "00002A71-0000-1000-8000-00805F9B34FB",
      batteryVoltage: "00002A19-0000-1000-8000-00805F9B34FB",
      solarVoltage: "00002A6E-0000-1000-8000-00805F9B34FB",
      temperature: "00002A1F-0000-1000-8000-00805F9B34FB",
      humidity: "00002A6F-0000-1000-8000-00805F9B34FB",
      pressure: "00002A6D-0000-1000-8000-00805F9B34FB",
    };

    document.getElementById("connectButton").addEventListener("click", async () => {
      try {
        const device = await navigator.bluetooth.requestDevice({
          acceptAllDevices: false,
          filters: [{ services: [serviceUUID] }],
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(serviceUUID);

        document.getElementById("data").innerHTML = "<p>Connected to TiltWind!</p>";

        // Loop through characteristics and listen for changes
        for (const [name, uuid] of Object.entries(characteristicUUIDs)) {
          const characteristic = await service.getCharacteristic(uuid);
          characteristic.startNotifications();
          characteristic.addEventListener("characteristicvaluechanged", (event) => {
            const value = new DataView(event.target.value.buffer).getFloat32(0, true);
            updateData(name, value);
          });
        }
      } catch (error) {
        console.error(error);
        document.getElementById("data").innerHTML = "<p>Error: " + error.message + "</p>";
      }
    });

    function updateData(name, value) {
      const dataDiv = document.getElementById("data");
      if (!document.getElementById(name)) {
        const para = document.createElement("p");
        para.id = name;
        dataDiv.appendChild(para);
      }
      document.getElementById(name).textContent = `${name}: ${value.toF
